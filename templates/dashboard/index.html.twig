{% extends 'base.html.twig' %}

{% block title %}Dashboard - {{ team.name }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        @media (max-width: 767px) {
            .display-4 {
                font-size: 2rem;
            }
            .card {
                margin-bottom: 1rem;
            }
        }
    </style>
{% endblock %}

{% block body %}
<nav class="navbar navbar-light bg-light sticky-top">
  <div class="container">
    <span class="navbar-brand">CTF TRACKER</span>
    <span class="badge bg-dark fs-6 font-monospace"
          data-controller="timer"
          data-timer-end-time-value="{{ challenge.endDate.timestamp }}"
          data-timer-start-time-value="{{ challenge.startDate.timestamp }}">
        --:--:--
    </span>
    <span>{{ team.name }}</span>
    <a href="{{ path('app_logout') }}" class="btn btn-outline-danger btn-sm">Deconnexion</a>
  </div>
</nav>

<div class="container py-4">
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title">VOTRE SCORE</h5>
          <p class="display-4 fw-bold font-monospace">{{ team.score }} pts</p>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card text-center">
        <div class="card-body">
          <h5 class="card-title">VOTRE RANG</h5>
          <p class="display-4 fw-bold">#{{ rank }}</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      {% if challenge.isUpcoming %}
        <div class="alert alert-info text-center">
          <h4>‚è≥ CHALLENGE A VENIR</h4>
          <p>Le challenge commence dans:</p>
          <span class="badge bg-dark fs-4 font-monospace"
                data-controller="timer"
                data-timer-end-time-value="{{ challenge.startDate.timestamp }}"
                data-timer-start-time-value="{{ challenge.startDate.timestamp }}">
            --:--:--
          </span>
        </div>
      {% elseif challenge.isEnded %}
        <div class="alert alert-secondary text-center">
          <h4>‚è±Ô∏è CHALLENGE TERMINE</h4>
          <p>Consultez le classement final</p>
          <a href="{{ path('app_leaderboard') }}" class="btn btn-primary">
            üèÜ Voir le leaderboard
          </a>
        </div>
      {% else %}
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">SOUMETTRE UN FLAG</h5>
            <form method="post">
              <div class="input-group mb-2">
                <input type="text"
                       name="flag"
                       class="form-control font-monospace"
                       placeholder="{{ challenge.prefix }}{...}"
                       value="{{ lastValue }}"
                       autofocus>
                <button type="submit" class="btn btn-primary">Valider</button>
              </div>
              <small class="text-muted">Format attendu: {{ challenge.prefix }}{...}</small>

              {% if feedback %}
                {% if feedback.success %}
                  <div class="alert alert-success mt-3 mb-0">
                    ‚úÖ {{ feedback.message }} +{{ feedback.points }} points
                  </div>
                {% else %}
                  <div class="alert alert-danger mt-3 mb-0">
                    ‚ùå {{ feedback.message }}
                  </div>
                {% endif %}
              {% endif %}
            </form>
          </div>
        </div>
      {% endif %}
    </div>
  </div>

  <div class="row mt-4">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">FLAGS VALIDES ({{ validatedFlags|length }}/{{ totalFlags }})</h5>
          {% if validatedFlags is empty %}
            <p class="text-muted empty-flags-message">Aucun flag valide pour le moment</p>
          {% else %}
            <ul class="list-group list-group-flush">
              {% for submission in validatedFlags %}
                <li class="list-group-item d-flex justify-content-between">
                  <span>{{ submission.flag.name }}</span>
                  <span class="badge bg-success">+{{ submission.flag.points }} pts</span>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </div>
      </div>

      <a href="{{ path('app_leaderboard') }}" class="btn btn-outline-secondary mt-3">
        Voir le leaderboard
      </a>
    </div>
  </div>
</div>
{% endblock %}
